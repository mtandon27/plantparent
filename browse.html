<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plant Parent - Explore</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå±</text></svg>"
    />

    <link rel="stylesheet" href="global.css" />
    </head>

  <body>
    <nav>
      <a href="index.html" class="nav-brand"><span>üå± PLANT PARENT</span></a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="browse.html" class="active">Explore</a></li>
        <li><a href="journal.html">Journal</a></li>
      </ul>
    </nav>

    <div class="full-width-container">
      <div class="page-header">
        <h1>Plant Database</h1>
        <p
          class="subtitle"
          style="
            background: var(--color-highlight);
            display: inline-block;
            padding: 2px 10px;
            transform: rotate(-1deg);
          "
        >
          Select a companion for your journey
        </p>
      </div>

      <div class="browse-layout">
        <aside class="sidebar">
          <div class="filter-section">
            <input
              type="text"
              class="search-input"
              placeholder="üîç Search Species..."
            />
          </div>

          <div style="margin-bottom: 2rem">
            <h3
              style="
                font-family: var(--font-heading);
                margin-bottom: 10px;
                text-decoration: underline;
              "
            >
              Traits
            </h3>
            <div class="checkbox-group">
              <label
                ><input type="checkbox" id="pet-friendly" /> üêæ Pet Safe</label
              >
              <label
                ><input type="checkbox" id="low-maintenance" /> üõ°Ô∏è
                Beginner</label
              >
              <label
                ><input type="checkbox" id="air-purifying" /> üå¨Ô∏è Air Buff</label
              >
            </div>
          </div>

          <div style="margin-bottom: 2rem">
            <h3
              style="
                font-family: var(--font-heading);
                margin-bottom: 10px;
                text-decoration: underline;
              "
            >
              Light Lvl
            </h3>
            <div class="radio-group">
              <label
                ><input type="radio" name="sunlight" value="full-sun" /> ‚òÄÔ∏è
                High</label
              >
              <label
                ><input type="radio" name="sunlight" value="partial-sun" /> ‚õÖ
                Med</label
              >
              <label
                ><input type="radio" name="sunlight" value="partial-shade" /> üå§Ô∏è
                Low</label
              >
              <label
                ><input type="radio" name="sunlight" value="full-shade" /> üåë
                Shadow</label
              >
            </div>
          </div>

          <button
            class="btn secondary-btn"
            onclick="clearAllFilters()"
            style="width: 100%"
          >
            Reset Filters
          </button>
        </aside>

        <div class="results-section" style="flex: 1">
          <div
            class="results-header"
            style="
              margin-bottom: 1rem;
              display: flex;
              justify-content: space-between;
            "
          >
            <p
              class="results-info"
              style="font-family: var(--font-heading); font-size: 1.5rem"
            >
              Found: <span id="count-display">0</span> Plants
            </p>
          </div>
          <div class="plant-grid"></div>
        </div>
      </div>
    </div>

    <div class="plant-detail-panel" id="detail-panel">
      <div class="panel-content">
        <button
          class="panel-close"
          id="panel-close-btn"
          style="
            position: absolute;
            top: 10px;
            right: 10px;
            background: red;
            color: white;
            border: 2px solid black;
            cursor: pointer;
            font-family: var(--font-heading);
            padding: 5px 10px;
          "
        >
          X
        </button>

        <h2
          id="panel-title"
          style="
            font-family: var(--font-heading);
            font-size: 3rem;
            margin-bottom: 0;
          "
        >
          Plant Name
        </h2>
        <p
          id="panel-alias"
          style="
            font-family: var(--font-body);
            font-style: italic;
            color: #666;
            margin-bottom: 1rem;
          "
        >
          Scientific Name
        </p>

        <div
          id="panel-image-container"
          style="
            background: #f0f0f0;
            border: 2px solid var(--color-ink);
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
          "
        ></div>

        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
            font-family: var(--font-heading);
            font-size: 1.3rem;
          "
        >
          <div
            style="
              border: 2px solid var(--color-ink);
              padding: 10px;
              background: white;
            "
          >
            <strong>üíß Water:</strong> <span id="panel-water">Weekly</span>
          </div>
          <div
            style="
              border: 2px solid var(--color-ink);
              padding: 10px;
              background: white;
            "
          >
            <strong>‚òÄÔ∏è Light:</strong> <span id="panel-sun">High</span>
          </div>
        </div>

        <div
          id="panel-safety"
          style="
            margin-bottom: 2rem;
            font-family: var(--font-heading);
            font-size: 1.3rem;
          "
        ></div>

        <div style="display: flex; gap: 1rem">
          <button class="primary-btn" style="flex: 1" id="btn-save">
            üíæ Save to Log
          </button>
        </div>
      </div>
    </div>
    <footer>
    <p style="font-family: var(--font-heading); font-size: 1.2rem; margin: 0;">
        &copy; 2025 Manvi Tandon. All rights reserved.
    </p>
  </footer>

    <script>
      let allPlants = [];
      let filteredPlants = [];

      // DOM Elements
      const searchInput = document.querySelector(".search-input");
      const plantGrid = document.querySelector(".plant-grid");
      const resultsInfo = document.querySelector(".results-info"); // Kept specifically for count
      const countDisplay = document.getElementById("count-display"); // New helper

      const petFriendlyCheckbox = document.getElementById("pet-friendly");
      const lowMaintenanceCheckbox = document.getElementById("low-maintenance");
      const airPurifyingCheckbox = document.getElementById("air-purifying");
      const sunlightRadios = document.getElementsByName("sunlight");

      // Detail Panel Elements
      const panel = document.getElementById("detail-panel");
      const closeBtn = document.getElementById("panel-close-btn");

      // Fetch Data
      fetch("plants.json")
        .then((response) => response.json())
        .then((data) => {
          allPlants = data.plants || data;
          filteredPlants = allPlants;
          renderPlants();
        })
        .catch((err) => console.error("Error loading plants:", err));

      // Filter Listeners
      searchInput.addEventListener("input", applyFilters);
      petFriendlyCheckbox.addEventListener("change", applyFilters);
      lowMaintenanceCheckbox.addEventListener("change", applyFilters);
      airPurifyingCheckbox.addEventListener("change", applyFilters);
      sunlightRadios.forEach((radio) =>
        radio.addEventListener("change", applyFilters)
      );

      function clearAllFilters() {
        searchInput.value = "";
        petFriendlyCheckbox.checked = false;
        lowMaintenanceCheckbox.checked = false;
        airPurifyingCheckbox.checked = false;
        sunlightRadios.forEach((r) => (r.checked = false));
        applyFilters();
      }

      function applyFilters() {
        const searchTerm = searchInput.value.toLowerCase();
        const petFriendly = petFriendlyCheckbox.checked;
        const lowMaintenance = lowMaintenanceCheckbox.checked;
        const airPurifying = airPurifyingCheckbox.checked;
        const selectedSunlight = Array.from(sunlightRadios).find(
          (r) => r.checked
        )?.value;

        filteredPlants = allPlants.filter((plant) => {
          // Search
          const displayName = (plant.display_pid || "").toLowerCase();
          const alias = (plant.alias || "").toLowerCase();
          if (!displayName.includes(searchTerm) && !alias.includes(searchTerm))
            return false;

          // Checkboxes
          if (
            petFriendly &&
            (plant.toxicity === true || plant.toxicity === "true")
          )
            return false;

          if (lowMaintenance) {
            const minDays = plant.min_watering_benchmark_days || 0;
            if (minDays < 7) return false; // Define "Low Maintenance" as infrequent watering
          }

          if (airPurifying) {
            const isAP = plant.tags?.includes("air-purifying");
            if (!isAP) return false;
          }

          // Sunlight Logic (Simplified for the game theme)
          if (selectedSunlight) {
            const minLux = plant.min_light_lux || 0;
            if (selectedSunlight === "full-shade" && minLux >= 3000)
              return false;
            if (
              selectedSunlight === "partial-shade" &&
              (minLux < 3000 || minLux >= 5000)
            )
              return false;
            if (
              selectedSunlight === "partial-sun" &&
              (minLux < 5000 || minLux >= 8000)
            )
              return false;
            if (selectedSunlight === "full-sun" && minLux < 8000) return false;
          }

          return true;
        });

        renderPlants();
      }

      // Updated Render Function for "Inventory Card" Look
      function renderPlants() {
        countDisplay.innerText = filteredPlants.length;

        if (filteredPlants.length === 0) {
          plantGrid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; font-family: var(--font-heading); font-size: 1.5rem;">No specimens match your query.</div>`;
          return;
        }

        plantGrid.innerHTML = filteredPlants
          .map((plant) => {
            const emoji = plant.emoji || "üå±";

            // Generate Tags HTML
            let tagsHtml = "";
            if (plant.tags) {
              tagsHtml = plant.tags
                .slice(0, 2)
                .map(
                  (tag) => `<span class="tag">${tag.replace("-", " ")}</span>`
                )
                .join("");
            }

            // Visual "Health Bar" for watering frequency (More days = fuller bar/easier)
            const waterDays = plant.min_watering_benchmark_days || 7;
            const waterWidth = Math.min(100, (waterDays / 20) * 100);

            return `
            <div class="plant-card" onclick="openPlantDetail('${plant.pid}')">
                <div class="card-image">
                    ${
                      plant.image_url
                        ? `<img src="${plant.image_url}" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">`
                        : ""
                    }
                    <div style="display:${
                      plant.image_url ? "none" : "block"
                    }">${emoji}</div>
                </div>
                
                <h3 style="font-family: var(--font-heading); margin:0; font-size: 1.6rem;">${
                  plant.display_pid
                }</h3>
                
                <div style="font-size: 0.9rem; font-family: var(--font-heading); margin-top: 5px;">
                    WATER FREQ:
                    <div class="stat-bar"><div class="stat-bar-fill" style="width: ${waterWidth}%"></div></div>
                </div>

                <div class="tags">${tagsHtml}</div>
            </div>
            `;
          })
          .join("");
      }

      // Modal Logic
      function openPlantDetail(pid) {
        const plant = allPlants.find((p) => p.pid === pid);
        if (!plant) return;

        document.getElementById("panel-title").innerText = plant.display_pid;
        document.getElementById("panel-alias").innerText = plant.alias || "";
        document.getElementById(
          "panel-water"
        ).innerText = `${plant.min_watering_benchmark_days} - ${plant.max_watering_benchmark_days} days`;
        document.getElementById(
          "panel-sun"
        ).innerText = `${plant.min_light_lux} Lux`;

        // Image
        const imgContainer = document.getElementById("panel-image-container");
        const emoji = plant.emoji || "üå±";
        if (plant.image_url) {
          imgContainer.innerHTML = `<img src="${plant.image_url}" style="max-height:100%; max-width:100%;" onerror="this.parentNode.innerHTML='<div style=\\'font-size:5rem;\\'>${emoji}</div>'">`;
        } else {
          imgContainer.innerHTML = `<div style="font-size:5rem;">${emoji}</div>`;
        }

        // Safety Badge
        const safetyContainer = document.getElementById("panel-safety");
        if (plant.toxicity) {
          safetyContainer.innerHTML = `<div style="padding:10px; background:#ffeaa7; border:2px solid var(--color-ink); color:black;">‚ö†Ô∏è <strong>Warning:</strong> Toxic to pets</div>`;
        } else {
          safetyContainer.innerHTML = `<div style="padding:10px; background:#55efc4; border:2px solid var(--color-ink); color:black;">‚úÖ <strong>Safe:</strong> Pet Friendly</div>`;
        }

        panel.classList.add("open");
      }

      closeBtn.onclick = () => panel.classList.remove("open");
      window.onclick = (e) => {
        if (e.target === panel) panel.classList.remove("open");
      };

      /* --- ADOPT / SAVE PLANT LOGIC --- */

      // Function to call when user clicks "Adopt" button on a plant
      function adoptPlant(plantName, plantEmoji) {
        // 1. Get current list
        let myPlants = JSON.parse(localStorage.getItem("myPlants")) || [];

        // 2. Check if already owned
        if (myPlants.some((p) => p.name === plantName)) {
          alert("You already have this plant in your garden!");
          return;
        }

        // 3. Add to list
        myPlants.push({ name: plantName, emoji: plantEmoji });

        // 4. Save back to storage
        localStorage.setItem("myPlants", JSON.stringify(myPlants));

        alert(
          `You adopted ${plantName}! It is now available in your Quest Log.`
        );
      }
    </script>
  </body>
</html>
